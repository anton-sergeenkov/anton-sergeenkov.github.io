<h2>Примеси</h2>

<ul class="list-links">
	<li><a href="#composition-mixins-basic">Основы</a></li>
	<li><a href="#composition-mixins-merge">Слияние опций</a></li>
	<li><a href="#composition-mixins-global">Глобальные примеси</a></li>
	<li><a href="#composition-mixins-user-merge">Пользовательские стратегии слияния опций</a></li>
</ul>

<ul class="list-point">
	<li><bg-define>Примеси (mixins)</bg-define> - гибкий инструмент повторного использования кода в компонентах Vue. Объект примеси может содержать любые опции компонентов. При использовании компонентом примеси, все опции примеси «подмешиваются» к собственным опциям компонента</li>
</ul>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3 id="composition-mixins-basic">Основы</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre><code class="js">
var mixin = {
    data() {
        return {
            mixinData: 'This is Mixin Data'
        }
    }
}
export default {
    <bg-code>mixins: [mixin]</bg-code>,
    created: function () {
        console.log(<bg-code>this.$data</bg-code>); // => { mixinData: "This is Mixin Data" }
    }
}
</code></pre>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3 id="composition-mixins-merge">Слияние опций</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
	<li>Если примесь и компонент содержат пересекающиеся опции, ожидающие значения в форме объектов, такие как <code class="txt">methods</code>, <code class="txt">components</code> и <code class="txt">directives</code> будут объединены. В случае конфликта, приоритет имеют опции компонента</li>
</ul>

<pre><code class="js">
var mixin = {
    data() {
        return {
            text: 'This is Mixin Text'
        }
    }
}
export default {
    mixins: [mixin],
    data() {
        return {
            text: 'This is Component Text'
        }
    },
    created: function () {
        console.log(this.$data); // => { text: "This is Component Text" }
    }
}
</code></pre>

<ul class="list-point">
	<li>Функции <code class="txt">хуков</code> с одинаковыми именами объединяются в массив, чтобы все они вызывались. Хуки примеси будут вызываться <u>перед</u> собственными хуками компонента</li>
</ul>

<pre><code class="js">
var mixin = {
	created: function () {
		console.log('Вызван хук примеси')
	}
}
export default {
	mixins: [mixin],
	created: function () {
		console.log('Вызван хук компонента')
	}
})
// => "Вызван хук примеси"
// => "Вызван хук компонента"
</code></pre>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3 id="composition-mixins-global">Глобальные примеси</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
	<li>Необходимо использовать осторожно. После применения, примесь окажет влияние на все экземпляры Vue, создаваемые в дальнейшем, включая внешние компоненты</li>
	<li>При правильном использовании это можно использовать для вставки логики обработки пользовательских опций</li>
	<li>Неплохой идеей будет их оформление в виде <u>плагинов</u>, что позволит избежать дублирования кода</li>
</ul>

<pre><code class="js">
// добавляем обработчик для пользовательской опции `myOption`
Vue.mixin({
	created: function () {
		var myOption = this.$options.myOption;
		if (myOption) {
			console.log(myOption);
		}
	}
})
new Vue({
	myOption: 'hello!'
})
// => "hello!"
</code></pre>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3 id="composition-mixins-user-merge">Пользовательские стратегии слияния опций</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
	<li>При слиянии пользовательских опций применяется стратегия по умолчанию, которая просто заменяет одни значения другими. Если вы хотите использовать пользовательскую логику при слиянии пользовательских опций, добавьте функцию в <code class="txt">Vue.config.optionMergeStrategies</code></li>
</ul>

<pre><code class="js">
Vue.config.optionMergeStrategies.myOption = function (toVal, fromVal) {
	// return mergedVal
}
</code></pre>

<ul class="list-point">
	<li>Для большей части опций-объектов можно просто использовать стратегию, применяемую по умолчанию для опции <code class="txt">methods</code></li>
</ul>

<pre><code class="js">
var strategies = Vue.config.optionMergeStrategies
strategies.myOption = strategies.methods
</code></pre>

<ul class="list-point">
	<li>Более сложным примером может послужить стратегия слияния из Vuex 1.x:</li>
</ul>

<pre><code class="js">
const merge = Vue.config.optionMergeStrategies.computed
Vue.config.optionMergeStrategies.vuex = function (toVal, fromVal) {
	if (!toVal) return fromVal
	if (!fromVal) return toVal
	return {
		getters: merge(toVal.getters, fromVal.getters),
		state: merge(toVal.state, fromVal.state),
		actions: merge(toVal.actions, fromVal.actions)
	}
}
</code></pre>