<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="icon" type="image/png" href="img/favicon.png">
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
<div id="container">
<div id="menu-left">
	<div id="menu-left-starter">
		<div id="menu-left-show"></div>
		<a href="#menu-top">Starter</a>
	</div>

	<div class="theme">Python ООП</div>
	<a href="#class">Классы, ООП</a>
	<a href="#obj">Объекты (словари)</a>

	<div class="theme">Python</div>
	<a href="#cmd">CMD</a>
	<a href="#type-data">Типы данных</a>
	<a href="#basis">Basis</a>
	<a href="#if">Условный оператор if</a>
	<a href="#circle">Циклы</a>
	<a href="#array">Списки (массивы)</a>
	<a href="#function">Функции</a>
	<a href="#module">Модули</a>
	<a href="#pyowm">Модуль определения погоды (pyowm)</a>
	<a href="#encode">Изменение кодировки на utf-8</a>
	<a href="#format">Форматирование строк. Метод format</a>
	<a href="#doc">Строки документирования (docstring)</a>

	<div class="theme">Python и MySQL</div>
	<a href="#mysql">Basic</a>

	<div class="theme">SQLAlchemy</div>
	<a href="#sqlalchemy">Basic</a>

	<div class="theme">Falcon</div>
	<a href="#falcon">Basic</a>
</div>
<div id="content-wrapper">
<div id="menu-top"></div>
<div id="content">





<h1>Python</h1>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="cmd">CMD</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="js">
<em>python</em>                   - проверка python
<em>python test.py</em>           - запустить программу test.py (cmd открыт из директории программы)
<em>pip install name_package</em> - установить пакет из PyPi
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="type-data">Типы данных</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
t1 = 25              # integer
t2 = 2.5             # float
t3 = 'строка'        # string
t4 = True            # boolean
t5 = None            # none (пустая переменная, если вывести значение функции без return)
t6 = {'key':'value'} # dictionary (словарь)
</code>
<code class="python">
str(a)   # преобразование в строку
int(a)   # преобразование в целое число
float(a) # преобразование в дробной число
list(a)  # преобразование в список
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="basis">Basis</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
print()                # вывод в консоль
print("Привет \"Мир")  # экранирование кавычек
print('Привет \nМир')  # перевод строки
print('''Привет 
Мир''')                # многострочный вывод
</code>
<code class="python">
a = input('Ваши имя: ') # запрос данных у пользователя (возвращает строку)
</code>
<code class="python">
print('Привет'*3)       # умножение строк
print(3*'Привет')       # умножение строк
</code>
<code class="python">
# лексиграфическое сравнение
# сравненеи строк, у какой строки больший вес
# регистр строк не учитывается
print ('Test' > 'Tesa')
</code>
<code class="python">
del test                # удаление переменной test
</code>
</pre>

<pre>
<code class="python">
# метасинтаксические переменные
# зарезервированные переменные, используемые в примерых для Python
foo
bar
</code>
</pre>

<pre>
<code class="python">
# in-place уместные операторы
a += 10
a += 1 # инкрементирование
</code>
</pre>

<pre>
<code class="python">
a1 = 5**2   # возведение степень (2)
a2 = 20//6  # частное (сколько 6 в числе 20)
a3 = 20 % 6 # деление по модулю
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="if">Условный оператор if</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
weather = 'Хорошая'

if weather == 'Хорошая':
	print('run')
else:
	print('wait')
</code>
<code class="python">
weather = 'Хорошая'
time = 'День'

if weather == 'Хорошая':
	print('run')
	if time == 'День':
		print('run run')
</code>
<code class="python">
weather = 'Хорошая'

if weather == 'Хорошая':
	print('run')
elif weather == 'Нормальная':
	print('go')
else:
	print('wait')
</code>
<code class="python">
weather = 'Хорошая'
time = 'День'

if weather == 'Хорошая' and ( time == 'День' or time == 'Ночь' ):
	print('run')
</code>
<code class="python">
weather = 'Хорошая'

if not weather == 'Хорошая':
	print('run')
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="circle">Циклы</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
i = 1
while i <= 5:
	print(i)
	i += 1
	if i == 3:
		break
</code>
<code class="python">
number = 0
while number <= 10:
	number += 1
	if (number % 2) != 0:
		continue;
	print('Четное число ' + str(number))
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="array">Списки (массивы)</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
arr1 = ['a', 'b', 'c']           # список
arr1[1]                          # обращение к элементу списка
</code>
<code class="python">
arr2 = ['a', 'b', ['d1', 'd2'] ] # список в списке
arr2[2][1]                       # обращение к элементу многомерного списка
</code>
<code class="python">
arr1 * 2                         # умножение списка ['a', 'b', 'c', 'a', 'b', 'c']
arr1 + ['d', 'i']                # сложение двух списков ['a', 'b', 'c', 'd', 'i']
</code>
<code class="python">
str1 = 'Привет'                  # строка
str1[2]                          # обращение к элементу строки
</code>
<code class="python">
arr1.append('d')    # добавление элемента в конец списка 
arr1.insert(0, 'z') # добавление элемента 'z' в заданную позицию '0' списка 
arr1.remove('a')    # удаление элемента списка
arr1.pop(1)         # удаление элемента списка по индексу
</code>
<code class="python">
len(arr1)           # длина списка
max(arr1)           # максимальный элемент списка
max(arr1)           # минимальный элемент списка
arr1.count('a')     # кол-во вхождений определенных значений в список (если значения повторяются)
arr1.reverse()      # перевернуть значения массива (ничего не возвращает, только изменяет список)
</code>
<code class="python">
# поверка наличия значения элемента в списке
if 'a' in arr1:
	print('A is in list')

# поверка отсутствия значения элемента в списке
if 'a' not in arr1:
	print('A is not in list')
</code>
</pre>

<h3>Диапазон</h3>
<pre>
<code class="python">
# диапазон
# возвращает не список, а итерируемые объекты диапазона
a = range(100)        # (0, 100)
b = range(50, 100)    # (50, 100)
c = range(50, 100, 2) # (50, 100) шаг генерации 2 (только четные числа)
</code>
<code class="python">
numbers = list(range(100)) # преобразование в список. список из 100 цифр
</code>
</pre>

<h3>Перебор списка</h3>
<pre>
<code class="python">
arr = ['a', 'b', 'c', 'd'] 

i = 0
length = len(arr) - 1

while i<=length:
	print(arr[i])
	i+=1
</code>
<code class="python">
arr = ['a', 'b', 'c', 'd'] 

for element in arr:
	print(element)
</code>
</pre>

<pre>
<code class="python">
# Выполнение кода заданное кол-во раз
for element in range(10):
	print('Выполнится 10 раз')
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="class">Классы, ООП</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="js">
# переменные - поля
# функции    - методы
# self обязательный аргумент в методе, содержащий в себе экземпляр класса, передающийся при вызове метода
</code>
</pre>

<pre>
<code class="js">
# объявление класса
class Person:
	name = 'Tony'
	age = 25
	def set(self, name, age):
		self.name = name
		self.age = age

superPerson = Person()       # создание объекта (экземпляра класса)
print(superPerson.name)      # обращение к свойству объекта

superPerson.set('Steve', 27) # изменение свойства объекта (свойство класса не изменяется)
print(superPerson.name)      # обращение к свойству объекта
</code>
</pre>

<h3>Наследование</h3>
<pre>
<code class="js">
# объявление нового класса, наследованого от Person
class Student(Person):
	course = 1

superStudent = Student()
superStudent.set('Jack', 19)
print(superStudent.name)
print(superStudent.course)
</code>
</pre>

<h3>Инкапсуляция</h3>
<pre>
<code class="js">
# одно нижнее подчеркивание - рекомендация не использовать свойсво/метод
# при использовании ошибка выдаваться не будет
class Person:
	_name = 'Tony'
	_age = 25
	def _set(self, name, age):
		self._name = name
		self._age = age

superPerson = Person()
print(superPerson._name)  
superPerson._set('Steve', 14) 
</code>
</pre>

<pre>
<code class="js">
# два нижних подчеркивания - более жесткая рекомендация не использовать свойсво/метод
# при использовании ошибка выдаваться будет
class Person:
	__name = 'Tony'
	__age = 25
	def __set(self, name, age):
		self.__name = name
		self.__age = age

# обход ошибки, обращение по классу
superPerson = Person()
print(superPerson._Person__name)  
superPerson._Person__set('Steve', 14)  
</code>
</pre>

<h3>Полиморфизм</h3>
<pre>
<code class="python">
# Полиморфизм - использование одного метода по разному в разных классах
print(2+2)     # для чисел сложение
print('2'+'2') # для строк конкатенация 
</code>
</pre>

<h3>Инициализация</h3>
<pre>
<code class="js">
class Person:
	def __init__(self, name, age):
		self.name = name
		self.age = age

superPerson = Person('Tony', 25)
print(superPerson.name, superPerson.age)
</code>
</pre>

<pre>
<code class="js">
# age=None выставление значения по умолчанию
class Person:
	def __init__(self, name, age=None):
		self.name = name
		self.age = age

superPerson = Person('Tony')
print(superPerson.name, superPerson.age)
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="obj">Объекты (словари)</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
dic = {
	'name': 'Tony',
	'age': 25,
	'address': {
		'town':'London',
		'home':'255'
	}
}

# если элемент не найден, вернет ошибку
print(dic['name']) 
print(dic['address']['town'])

# если элемент не найден, вернет None, если не задан 2 аргумент
print(dic.get('name', 'Значение не найдено'))
</code>
</pre>

<pre class="python">
<code>
# проверка существования ключа в словаре
if ('name1') in dic: 
	print('exists')
else:
	print('not exists')
</code>
</pre>

<h3>Перебор значений словаря (value)</h3>
<pre class="python">
<code class="python">
for value in dic: 
	print(value)
</code>
</pre>

<h3>Перебор значений словаря (value) и номера текущей итерации (index)</h3>
<pre class="python">
<code class="python">
for index, value in enumerate(dic): 
	print(index)
	print(value)
</code>
</pre>



<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="function">Функции</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
def sum(a, b):
	return a+b

# функция изначально должна быть определена
a = sum(5,10) # вызов функции
a = sum       # запись функции в переменную, которую можно вызвать a(5,10)
</code>
</pre>

<h3>Передача функции аргументов в другую функцию</h3>
<pre>
<code class="python">
def greet(name):
	print('Hi' + name())

def get_name():
	return input('Input name ')

greet(get_name)
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="doc">Строки документирования (docstring)</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
def sum(a, b):
	'''Описание функции'''
	print(a+b)

# получить строку документирования
sum.__doc__
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="format">Форматирование строк. Метод format</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
# если для подстановки требуется только один аргумент, то значение - сам аргумент
a = 'Hello {}'.format('Tony')           # 'Hello, Tony!'
a = 'Hello {name}'.format(name='Tony')  # 'Hello, Tony!'

# если для подстановки требуется несколько аргументов
a = '{0}, {1}, {2}'.format('a', 'b', 'c') # 'a, b, c' 
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="module">Модули</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="js">
1. Модули, которые написали сами
2. Модули внешние, загруженные с интернета
3. Модули, интергированные в Python (STL - standart library)

PyPi - репозиторий Python
pip - программа, позволяющая устанавливать пакеты из PyPi
</code>
</pre>

<pre>
<code class="js">
import math                      # импорт объекта модуля (нужно обращаться к объекту)
from math import sqrt            # импорт отдельной функции модуля
from math import sqrt as my_sqrt # импорт отдельной функции модуля и ее переименование
from math import sqrt, pi        # импорт нескольких методов/свойств
from math import *               # получить все свойства и методы
</code>
</pre>

<h3>Random</h3>
<pre>
<code class="python">
print(random.randint(1, 100)) # от 1 до 100 (обращение к объекту)
print(randint(1, 100))        # от 1 до 100 (обращение к методу)
</code>
</pre>

<h3>Math</h3>
<pre>
<code class="python">
print(sqrt(25)) # квадратный корень
print(pi)       # число Пи
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="pyowm">Модуль определения погоды (pyowm)</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
import pyowm

owm = pyowm.OWM('6d00d1d4e704068d70191bad2673e0cc')
observation = owm.weather_at_place('London')
w = observation.get_weather()

temperature = w.get_temperature('celsius')['temp'];
status = w.get_detailed_status()

print(temperature, status)
</code>
</pre>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 id="encode">Изменение кодировки на utf-8</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<pre>
<code class="python">
import sys
sys.stdout.reconfigure(encoding='utf-8')
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 class="select">Python и MySQL</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<h3 id="mysql">Basic</h3>

<pre>
<code>
<a href="https://www.w3schools.com/python/python_mysql_getstarted.asp" target="_blank">w3schools</a>
</code>
</pre>

<pre>
<code class="js">
<em>pip install mysql-connector</em>
</code>
</pre>

<h3>encoding_content.py</h3>
<pre>
<code class="python">
# кодировка utf-8
import sys
sys.stdout.reconfigure(encoding='utf-8')

# вывод html
print("Content-Type: text/html\n")
</code>
</pre>

<h3>db_сonnect.py</h3>
<pre>
<code class="python">
import mysql.connector
mydb = mysql.connector.connect(
	host="localhost",
	user="root",
	passwd="",
	database="motmom"
)
</code>
</pre>

<h3>db_select.py</h3>
<pre>
<code class="python">
#!C:/Users/Sawyer/AppData/Local/Programs/Python/Python37-32/python.exe
import encoding_content
import db_сonnect

mycursor = db_сonnect.mydb.cursor()
mycursor.execute("SELECT * FROM event")
myresult = mycursor.fetchall()

arr = []
for x in myresult:
	arr.append([x[0], x[1], str(x[2])])
print(arr)
</code>
</pre>

<h3>db_insert.py</h3>
<pre>
<code class="python">
#!C:/Users/Sawyer/AppData/Local/Programs/Python/Python37-32/python.exe
import encoding_content
import db_сonnect

mycursor = db_сonnect.mydb.cursor()
sql = "INSERT INTO event (NAME, TIME) VALUES (%s, %s)"
val = ("TestName", "12:12:12")
mycursor.execute(sql, val)
db_сonnect.mydb.commit()
print(mycursor.rowcount, "record inserted.")
</code>
</pre>

<h3>db_update.py</h3>
<pre>
<code class="python">
#!C:/Users/Sawyer/AppData/Local/Programs/Python/Python37-32/python.exe
import encoding_content
import db_сonnect

mycursor = db_сonnect.mydb.cursor()
sql = "UPDATE event SET NAME='UpdateName', TIME='01.01.01' WHERE ID=7"
mycursor.execute(sql)
db_сonnect.mydb.commit()
print(mycursor.rowcount, "record(s) affected")
</code>
</pre>

<h3>db_delete.py</h3>
<pre>
<code class="python">
#!C:/Users/Sawyer/AppData/Local/Programs/Python/Python37-32/python.exe
import encoding_content
import db_сonnect

mycursor = db_сonnect.mydb.cursor()
sql = "DELETE FROM event WHERE ID=7"
mycursor.execute(sql)
db_сonnect.mydb.commit()
print(mycursor.rowcount, "record(s) deleted")
</code>
</pre>

<pre>
<code class="js">
// JavaScript Code (SELECT)
$.get('python/db_select.py', {}, function(data) {
	var arr = eval(data);
	var result = '';
	for(var i=0; i&lt;arr.length; i++) {
		var id   = arr[i][0];
		var name = arr[i][1];
		var time = arr[i][2];
		result += `&lt;div&gt;${id} ${name} ${time}&lt;/div&gt;`;
	}
	$('body').append(result);
})
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 class="select">SQLAlchemy</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<h3 id="sqlalchemy">Basic</h3>

<pre>
<code class="html">
<a href="http://wiki.python.su/Документации/SQLAlchemy" target="_blank">wiki.python.su</a>
<a href="https://ru.wikibooks.org/wiki/SQLAlchemy" target="_blank">wikibooks.org</a>
<a href="https://docs.sqlalchemy.org/en/latest/" target="_blank">docs.sqlalchemy.org</a>
<a href="https://docs.sqlalchemy.org/en/latest/orm/tutorial.html" target="_blank">docs.sqlalchemy.org tutorial</a>
<a href="https://docs.sqlalchemy.org/en/latest/dialects/mysql.html" target="_blank">docs.sqlalchemy.org mysql</a>
<a href="https://slides.com/kataev/sqlalchemy-pycon#/" target="_blank">slides.com</a>
<a href="https://stackoverflow.com/questions/22252397/importerror-no-module-named-mysqldb" target="_blank">stackoverflow.com mysqldb</a>
</code>
</pre>

<pre>
<code class="js">
<em>pip install SQLAlchemy</em>
<em>pip install pymysql</em>
<em>pip install --upgrade SQLAlchemy</em>
</code>
</pre>

<h3>Тестирование</h3>
<pre>
<code class="python">
import sqlalchemy
print (sqlalchemy.__version__) # посмотреть версию SQLALchemy
</code>
</pre>

<h3>Работа с БД</h3>

<h4>Connect</h4>
<pre>
<code class="python">
from sqlalchemy import create_engine
engine = create_engine('mysql+pymysql://root:123@localhost/motmom')
# root      - user
# 123       - password
# localhost - host
# motmom    - db name
</code>
</pre>

<h4>Declarative creation of a table, class</h4>
<pre>
<code class="js">
from sqlalchemy import Column, Integer, String
from sqlalchemy.ext.declarative import declarative_base
Base = declarative_base()

class User(Base):
    __tablename__ = 'users'
    id = Column(Integer, primary_key=True)
    name = Column(String(50))
    fullname = Column(String(50))
    password = Column(String(50))
    
    def __init__(self, name, fullname, password):
        self.name = name
        self.fullname = fullname
        self.password = password
    def __repr__(self):
        return "&lt;User('%s','%s', '%s')&gt;" % (self.name, self.fullname, self.password)

# users_table = User.__table__ # доступ к имени таблицы

# create table
Base.metadata.create_all(engine)
</code>
</pre>


<h4>Session</h4>
<pre>
<code class="python">
from sqlalchemy.orm import sessionmaker
Session = sessionmaker(bind=engine)
session = Session()

# select query
for instance in session.query(User).order_by(User.id): 
    print(instance.name, instance.fullname)

# insert query
insertRecord = User('Tony', 'Tony Stark', 'TonyFirst')
session.add(insertRecord)
session.commit()

# update query
updateRecord = session.query(User).filter_by(id=1).first()
updateRecord.name = 'New Name'
session.commit()

# delete query
deleteRecord = session.query(User).filter_by(id=1).first()
session.delete(deleteRecord)
session.commit()
</code>
</pre>

<pre>
<code class="python">
session.close()
</code>
</pre>

<h4>Select Query</h4>
<pre>
<code class="python">
query1 = session.query(User).filter_by(name='Tony').first() # выбрать 1 запись по совпадению поля name
query2 = session.query(User).filter(User.name=='Tony')      # выбрать 1 запись по совпадению поля name
query3 = session.query(User).filter(User.name=='Tony').filter(User.fullname=='Stark') # выбрать 1 запись по совпадению поля name и fullname
query4 = session.query(User).order_by(User.id)              # выбрать все записи, все поля, сортировка по ID
query5 = session.query(User.name).order_by(User.id)         # выбрать все записи, поле name, сортирока по ID
</code>
</pre>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h2 class="select">Falcon</h2>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<h3 id="falcon">Basic</h3>

<pre>
<code class="html">
<a href="https://falcon.readthedocs.io/en/stable/" target="_blank">falcon.readthedocs.io</a>
<a href="https://insomnia.rest/" target="_blank">Insomnia REST Client</a>
</code>
</pre>

<pre>
<code class="js">
<em>pip install falcon</em>
<em>pip install waitress</em>
<em>pip install [gunicorn|uwsgi|waitress]</em>
</code>
</pre>

<pre>
<code>
<em>Falcon</em> является фреймворком <em>WSGI</em>, потому для работы веб-приложения потребуется сервер приложений WSGI

1. <em>Gunicorn</em>. Gunicorn для <em>UNIX-среды</em> несовместим с Windows. UNIX - семейство операционных систем (Mac OS X, GNU/Linux).
2. <em>uWSGI</em>
3. <em>Waitress</em>
</code>
</pre>

<h3>Simple Text</h3>
<pre>
<code class="js">
import falcon
from waitress import serve

class ObjRes(object):
    def on_get(self, req, resp):
    	resp.status = falcon.HTTP_200
    	resp.body = 'hello world'

api = falcon.API()
api.add_route('/', ObjRes())
serve(api, host="127.0.0.1", port=8001)
</code>
<code class="python">
python app.py
http://127.0.0.1:8001/
</code>
</pre>


<h3>HTML</h3>
<pre>
<code class="js">
import falcon
from waitress import serve

class ObjRes(object):
    def on_get(self, req, resp):
    	resp.status = falcon.HTTP_200
    	resp.content_type = falcon.MEDIA_HTML
    	resp.body = '&lt;h1&gt;Hello World&lt;/h1&gt;'

api = falcon.API()
api.add_route('/', ObjRes())
serve(api, host="127.0.0.1", port=8001)
</code>
<code class="python">
python app.py
http://127.0.0.1:8001/
</code>
</pre>


<h3>Json (Object)</h3>
<pre>
<code class="js">
import falcon, json
from waitress import serve

class ObjRes(object):
    def on_get(self, req, resp):
    	resp.status = falcon.HTTP_200
    	content = {
    		'name':'Tony',
    		'age':'25',
    		'country':'Russia'
    	}
    	resp.body = json.dumps(content)

api = falcon.API()
api.add_route('/', ObjRes())
serve(api, host="127.0.0.1", port=8001)
</code>
<code class="python">
http://127.0.0.1:8001/
{"name": "Tony", "age": "25", "country": "Russia"}
</code>
</pre>



<h3>Json (read URL)</h3>
<pre>
<code class="js">
import falcon, json
from waitress import serve

class ObjRes(object):
	def on_get(self, req, resp):
		resp.status = falcon.HTTP_200

		validate_params = True

		if 'name' not in req.params:
			validate_params = False

		if (validate_params is True):
			output = {
				'name' : req.params['name']
			}
		else:
			output = {
				'error' : 'You need name in your params'
			}
		resp.body = json.dumps(output)

api = falcon.API()
api.add_route('/', ObjRes())
serve(api, host="127.0.0.1", port=8001)
</code>
<code class="python">
http://127.0.0.1:8001/
{"error": "You need name in your params"}

http://127.0.0.1:8001/?name=Tony
{"name": "Tony"}
</code>
</pre>


<h3>Read Params</h3>
<pre>
<code>
# read url params http://127.0.0.1:8001/?name=Tony
name = req.params['name']	
# req.host
# req.path
# req.query_string

# read json params {"name" : "Tony"}
data = json.loads(req.stream.read())
a = data['name']
</code>
</pre>


<h3>HTTP-методы GET/POST/PUT/DELETE</h3>
<pre>
<code class="js">
import falcon, json
from waitress import serve

class ObjRes(object):
    def on_get(self, req, resp):
    	resp.status = falcon.HTTP_200
    	data = json.loads(req.stream.read())
    	output = {
    		'msg' : 'Hello {0}'.format(data['name'])
    	}
    	resp.body = json.dumps(output)

    def on_post(self, req, resp):
    	resp.status = falcon.HTTP_200
    	data = json.loads(req.stream.read())
    	equel = int(data['x']) + int(data['y'])
    	output = {
    		'msg' : 'x: {x} + y: {y} is equel to {e}'.format(x=data['x'], y=data['y'], e=equel)
    	}
    	resp.body = json.dumps(output)

    def on_put(self, req, resp):
    	resp.status = falcon.HTTP_200
    	output = {
    		'msg' : 'put is not supported'
    	}
    	resp.body = json.dumps(output)

    def on_delete(self, req, resp):
    	resp.status = falcon.HTTP_200
    	output = {
    		'msg' : 'delete is not supported'
    	}
    	resp.body = json.dumps(output)

api = falcon.API()
api.add_route('/', ObjRes())
serve(api, host="127.0.0.1", port=8001)
</code>
<code class="js">
# GET
# JSON { "name": "Tony" }
# Result { "msg": "Hello Tony" }

# POST
# JSON { "x": "100", "y": "200" }
# Result { "msg": "x: 100 + y: 200 is equel to 300" }
</code>
</pre>


<h3>Validated JSON input</h3>
<pre>
<code class="js">
import falcon, json
from waitress import serve

class ObjRes(object):

	__json_content = {}

	def __validate_json_input(self, req):
		try:
			self.__json_content = json.loads(req.stream.read())
			print('json from client is validated')
			return True
		except ValueError:
			self.__json_content = {}
			print('json from client is not validated')
			return False

	def on_get(self, req, resp):
		resp.status = falcon.HTTP_200
		validated = self.__validate_json_input(req)
		output = {
			'status' : 200,
			'msg' : None
		}

		if (validated == True):
			if 'name' in self.__json_content:
				output['msg'] = 'Hello {name}'.format(name=self.__json_content['name'])
			else:
				output['status'] = 404
				output['msg'] = 'json input need name params'
		else:
			output['status'] = 404
			output['msg'] = 'json input is not validated'

		resp.body = json.dumps(output)

api = falcon.API()
api.add_route('/', ObjRes())
serve(api, host="127.0.0.1", port=8001)
</code>
</pre>


<h3>Hooks</h3>
<pre>
<code class="js">
import falcon
from waitress import serve

class Authorize(object):
	def __init__(self, roles):
		self._roles = roles

	def __call__(self, req, resp, resource, params):
		# DB - Get user role
		if 'Admin' in self._roles:
			req.user_id = 5 
		else:
			raise falcon.HTTPBadRequest('Bad request', 'You are not a admin right now')

class ObjRes(object):

	@falcon.before(Authorize(['Admin','Normal','Guest']))

	def on_get(self, req, resp):
		output = {
			'method':'get',
			'user-id':req.user_id
		}
		resp.media = output

	@falcon.before(Authorize(['Normal','Guest']))
	def on_post(self, req, resp):
		output = {
			'method':'post',
			'user-id':req.user_id
		}
		resp.media = output

api = falcon.API()
api.add_route('/', ObjRes())
serve(api, host="127.0.0.1", port=8001)
</code>
</pre>


<h3>Basic Auth</h3>
<pre>
<code class="js">
import falcon
import base64
from waitress import serve

user_accounts = {
	'admin':'123'
}

class Authorize(object):
	def __init__(self):
		pass

	def __auth_basic(self, username, password):
		if username in user_accounts and user_accounts[username] == password:
			print('You have access')
		else:
			raise falcon.HTTPUnauthorized('Unauthorized', 'You access is not a allowed')

	def __call__(self, req, resp, resource, params):
		auth_exp = req.auth.split(' ') if req.auth is not None else (None, None)

		if auth_exp[0] is not None and auth_exp[0].lower() == 'basic':
			auth = base64.b64decode(auth_exp[1]).decode('utf-8').split(':')
			username = auth[0]
			password = auth[1]
			self.__auth_basic(username, password)
		else:
			raise falcon.HTTPNotInplemented('Not Inplemented', 'You don\'t use the right auth method')

class ObjRes(object):

	@falcon.before(Authorize())

	def on_get(self, req, resp):
		output = {
			'method':'get'
		}
		resp.media = output

api = falcon.API()
api.add_route('/', ObjRes())
serve(api, host="127.0.0.1", port=8001)
</code>
</pre>

<pre>
<code>
Insomnia -> Basic Auth
</code>
</pre>



</div>
</div>
</div>
	<div id="preloader"></div>
    <script src="libraries/jquery.js"></script>
	<script src="libraries/highlight/highlight.pack.js"></script>
	<script src="js/main.js"></script>
	<script src="module/preloader/preloader.js"></script>
</body>
</html>
